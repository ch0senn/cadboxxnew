<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>3D Machine Assembly - A-Frame Physics</title>
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.rawgit.com/donmccurdy/aframe-extras/master/dist/aframe-extras.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-system/dist/aframe-physics-system.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            height: 100vh;
            width: 100%;
            overflow: hidden;
        }

        #scene-container {
            width: 100%;
            height: 100vh;
        }

        #ui-panel {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            max-width: 400px;
            z-index: 10;
            border: 2px solid #00ff00;
        }

        .ui-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
            letter-spacing: 2px;
        }

        .ui-section {
            margin: 10px 0;
            font-size: 12px;
            line-height: 1.6;
        }

        .ui-label {
            color: #00ffff;
            font-weight: bold;
        }

        #controls-panel {
            position: absolute;
            bottom: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #00ff00;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            border: 2px solid #00ff00;
            z-index: 10;
        }

        button {
            background: #00ff00;
            color: #000;
            border: none;
            padding: 10px 15px;
            margin: 5px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            font-family: 'Courier New', monospace;
            transition: all 0.3s ease;
        }

        button:hover {
            background: #00cc00;
            transform: scale(1.05);
        }

        button:active {
            transform: scale(0.95);
        }

        #info-panel {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            color: #ffff00;
            padding: 15px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 11px;
            border: 2px solid #ffff00;
            max-width: 300px;
            z-index: 10;
        }

        .status-good {
            color: #00ff00;
        }

        .status-warn {
            color: #ffff00;
        }

        .status-error {
            color: #ff0000;
        }
    </style>
</head>
<body>
    <div id="ui-panel">
        <div class="ui-title">‚öôÔ∏è Machine Assembly</div>
        <div class="ui-section">
            <span class="ui-label">Environment:</span> 50m Virtual Cube
        </div>
        <div class="ui-section">
            <span class="ui-label">Physics Engine:</span> Enabled
        </div>
        <div class="ui-section">
            <span class="ui-label">Total Parts:</span> <span id="part-count">0</span>
        </div>
        <div class="ui-section">
            <span class="ui-label">Active Joints:</span> <span id="joint-count">0</span>
        </div>
        <div class="ui-section">
            <span class="ui-label">Controls:</span>
            <br>WASD - Move
            <br>Space - Jump
            <br>Mouse - Look
            <br>Buttons - Assemble
        </div>
    </div>

    <div id="info-panel">
        <div class="ui-title">üìä System Status</div>
        <div id="status-text" class="status-good">Physics: Active</div>
        <div id="fps-text" class="status-good">FPS: --</div>
        <div id="parts-text" class="status-good">Parts Rendered: 0</div>
    </div>

    <div id="controls-panel">
        <button onclick="addPart('cylinder')">Add Motor</button>
        <button onclick="addPart('box')">Add Joint</button>
        <button onclick="addPart('sphere')">Add Wheel</button>
        <button onclick="assembleRandomly()">Random Assembly</button>
        <button onclick="resetScene()">Reset Scene</button>
    </div>

    <a-scene id="main-scene" physics="debug: false; gravity: 0 -9.8 0" background="color: #000814">
        <!-- Camera -->
        <a-camera id="main-camera" position="0 2 15" look-controls wasd-controls>
            <a-cursor color="#ffff00"></a-cursor>
        </a-camera>

        <!-- Lighting -->
        <a-light type="ambient" color="#ffffff" intensity="0.6"></a-light>
        <a-light type="directional" color="#ffffff" intensity="0.8" position="10 10 10"></a-light>
        <a-light type="point" color="#00ff00" intensity="0.5" position="-10 5 10"></a-light>
        <a-light type="point" color="#0099ff" intensity="0.5" position="10 5 -10"></a-light>

        <!-- Virtual Cube Boundary (50m x 50m x 50m) -->
        <a-entity id="boundary-box">
            <!-- Floor -->
            <a-plane id="floor" position="0 -25 0" rotation="-90 0 0" width="50" height="50"
                     color="#1a3a52" opacity="0.3" static-body></a-plane>

            <!-- Ceiling -->
            <a-plane id="ceiling" position="0 25 0" rotation="90 0 0" width="50" height="50"
                     color="#0f0f0f" opacity="0.2" static-body></a-plane>

            <!-- Back Wall -->
            <a-plane id="wall-back" position="0 0 -25" width="50" height="50"
                     color="#003d5c" opacity="0.15" static-body></a-plane>

            <!-- Front Wall -->
            <a-plane id="wall-front" position="0 0 25" width="50" height="50"
                     color="#003d5c" opacity="0.15" static-body></a-plane>

            <!-- Left Wall -->
            <a-plane id="wall-left" position="-25 0 0" rotation="0 90 0" width="50" height="50"
                     color="#003d5c" opacity="0.15" static-body></a-plane>

            <!-- Right Wall -->
            <a-plane id="wall-right" position="25 0 0" rotation="0 90 0" width="50" height="50"
                     color="#003d5c" opacity="0.15" static-body></a-plane>

            <!-- Grid lines for reference -->
            <a-entity id="grid">
                <!-- Grid on floor -->
                <a-entity position="0 -24.9 0" geometry="primitive: plane; width: 50; height: 50"
                         material="shader: grid; color: #0099ff; cellSize: 2.5; cellColor: #006699"
                         rotation="-90 0 0" opacity="0.1"></a-entity>
            </a-entity>
        </a-entity>

        <!-- Parts Container -->
        <a-entity id="parts-container"></a-entity>

        <!-- Joints Container -->
        <a-entity id="joints-container"></a-entity>

        <!-- Assembly Base Platform -->
        <a-box id="assembly-base" position="0 -20 0" width="10" height="1" depth="10"
               color="#ff6b6b" static-body opacity="0.7"></a-box>

        <!-- Coordinate Axis Helper -->
        <a-entity position="0 0 0">
            <a-cylinder color="#ff0000" height="5" radius="0.1" position="2.5 0 0"></a-cylinder>
            <a-cylinder color="#00ff00" height="5" radius="0.1" position="0 2.5 0" rotation="90 0 0"></a-cylinder>
            <a-cylinder color="#0000ff" height="5" radius="0.1" position="0 0 2.5" rotation="0 90 0"></a-cylinder>
        </a-entity>
    </a-scene>

    <script>
        // Configuration
        const CONFIG = {
            SCENE_SIZE: 50,
            HALF_SIZE: 25,
            MAX_PARTS: 50,
            MAX_JOINTS: 100,
            PART_SCALE: 1,
            JOINT_STRENGTH: 100
        };

        // State Management
        const STATE = {
            parts: [],
            joints: [],
            partCount: 0,
            jointCount: 0,
            isAssembling: false
        };

        // Initialize
        function init() {
            console.log('üîß Machine Assembly System Initialized');
            console.log(`üì¶ Environment: ${CONFIG.SCENE_SIZE}m x ${CONFIG.SCENE_SIZE}m x ${CONFIG.SCENE_SIZE}m cube`);
            updateUI();
            setupPhysicsDebug();
        }

        // Setup Physics Debug
        function setupPhysicsDebug() {
            const scene = document.querySelector('#main-scene');
            // Physics is enabled by default in A-Frame
        }

        // Add Part to Scene
        function addPart(type) {
            if (STATE.partCount >= CONFIG.MAX_PARTS) {
                console.warn('‚ö†Ô∏è Maximum parts reached!');
                return;
            }

            const container = document.querySelector('#parts-container');
            const partId = `part-${STATE.partCount}`;
            const part = document.createElement('a-entity');

            // Random position within bounds
            const x = (Math.random() - 0.5) * (CONFIG.SCENE_SIZE - 4);
            const y = Math.random() * 10 - 15;
            const z = (Math.random() - 0.5) * (CONFIG.SCENE_SIZE - 4);

            part.setAttribute('id', partId);
            part.setAttribute('position', `${x} ${y} ${z}`);
            part.setAttribute('dynamic-body', '');

            // Define part based on type
            switch (type) {
                case 'cylinder':
                    part.setAttribute('geometry', 'primitive: cylinder; radius: 0.5; height: 2');
                    part.setAttribute('material', 'color: #ff6b6b; metalness: 0.8; roughness: 0.2');
                    break;
                case 'box':
                    part.setAttribute('geometry', 'primitive: box; width: 1; height: 1; depth: 1');
                    part.setAttribute('material', 'color: #4ecdc4; metalness: 0.9; roughness: 0.1');
                    break;
                case 'sphere':
                    part.setAttribute('geometry', 'primitive: sphere; radius: 0.7');
                    part.setAttribute('material', 'color: #95e1d3; metalness: 0.8; roughness: 0.3');
                    break;
                default:
                    part.setAttribute('geometry', 'primitive: box; width: 0.5; height: 0.5; depth: 0.5');
                    part.setAttribute('material', 'color: #ffd93d');
            }

            container.appendChild(part);

            STATE.parts.push({
                id: partId,
                type: type,
                element: part,
                position: { x, y, z }
            });

            STATE.partCount++;
            console.log(`‚úÖ Added ${type}: ${partId}`);
            updateUI();
        }

        // Create Joint Between Two Parts
        function createJoint(partId1, partId2) {
            if (STATE.jointCount >= CONFIG.MAX_JOINTS) {
                console.warn('‚ö†Ô∏è Maximum joints reached!');
                return;
            }

            const part1 = document.querySelector(`#${partId1}`);
            const part2 = document.querySelector(`#${partId2}`);

            if (!part1 || !part2) return;

            const jointId = `joint-${STATE.jointCount}`;
            const container = document.querySelector('#joints-container');

            // Get positions for joint visualization
            const pos1 = part1.getAttribute('position');
            const pos2 = part2.getAttribute('position');

            const midX = (pos1.x + pos2.x) / 2;
            const midY = (pos1.y + pos2.y) / 2;
            const midZ = (pos1.z + pos2.z) / 2;

            // Create visual joint connector
            const joint = document.createElement('a-entity');
            joint.setAttribute('id', jointId);
            joint.setAttribute('position', `${midX} ${midY} ${midZ}`);

            // Create connector line
            const connector = document.createElement('a-cylinder');
            const distance = Math.sqrt(
                Math.pow(pos2.x - pos1.x, 2) +
                Math.pow(pos2.y - pos1.y, 2) +
                Math.pow(pos2.z - pos1.z, 2)
            );

            connector.setAttribute('radius', '0.15');
            connector.setAttribute('height', distance);
            connector.setAttribute('color', `#${Math.floor(Math.random()*16777215).toString(16)}`);
            connector.setAttribute('opacity', '0.7');

            joint.appendChild(connector);
            container.appendChild(joint);

            STATE.joints.push({
                id: jointId,
                partId1,
                partId2,
                element: joint
            });

            STATE.jointCount++;
            console.log(`üîó Joint created: ${partId1} ‚Üî ${partId2}`);
            updateUI();
        }

        // Random Assembly
        function assembleRandomly() {
            // Add random parts
            const types = ['cylinder', 'box', 'sphere'];
            const numParts = Math.min(8, CONFIG.MAX_PARTS - STATE.partCount);

            for (let i = 0; i < numParts; i++) {
                const type = types[Math.floor(Math.random() * types.length)];
                addPart(type);
            }

            // Create random joints
            setTimeout(() => {
                for (let i = 0; i < Math.min(6, STATE.parts.length - 1); i++) {
                    const idx1 = Math.floor(Math.random() * STATE.parts.length);
                    const idx2 = Math.floor(Math.random() * STATE.parts.length);

                    if (idx1 !== idx2) {
                        createJoint(STATE.parts[idx1].id, STATE.parts[idx2].id);
                    }
                }
            }, 100);
        }

        // Reset Scene
        function resetScene() {
            // Remove all parts
            STATE.parts.forEach(part => {
                part.element.parentNode.removeChild(part.element);
            });

            // Remove all joints
            STATE.joints.forEach(joint => {
                joint.element.parentNode.removeChild(joint.element);
            });

            STATE.parts = [];
            STATE.joints = [];
            STATE.partCount = 0;
            STATE.jointCount = 0;

            console.log('üîÑ Scene Reset');
            updateUI();
        }

        // Update UI
        function updateUI() {
            document.querySelector('#part-count').textContent = STATE.partCount;
            document.querySelector('#joint-count').textContent = STATE.jointCount;
            document.querySelector('#parts-text').textContent = `Parts Rendered: ${STATE.partCount}`;
        }

        // FPS Counter
        let frameCount = 0;
        let lastTime = Date.now();

        function updateFPS() {
            frameCount++;
            const currentTime = Date.now();
            const elapsed = currentTime - lastTime;

            if (elapsed > 1000) {
                const fps = Math.round((frameCount * 1000) / elapsed);
                document.querySelector('#fps-text').textContent = `FPS: ${fps}`;
                frameCount = 0;
                lastTime = currentTime;
            }

            requestAnimationFrame(updateFPS);
        }

        // Start FPS counter
        updateFPS();

        // Initialize on scene load
        document.querySelector('#main-scene').addEventListener('loaded', function () {
            init();
        });

        // Alternative initialization if scene is already loaded
        setTimeout(() => {
            if (!document.querySelector('#main-scene').hasLoaded) {
                init();
            }
        }, 1000);
    </script>
</body>
</html>
